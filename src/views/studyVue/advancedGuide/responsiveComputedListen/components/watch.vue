<!-- watch -->
<template>
  <div ref="watchTitle">I am watch</div>
</template>
<script>
import { defineComponent, h, reactive, ref, watch, watchEffect } from 'vue'

export default defineComponent({
  setup() {
    /**
     * ä¸watchEffectæ¯”è¾ƒ watchå…è®¸æˆ‘ä»¬ï¼š
     * 1ã€æ‡’æ‰§è¡Œå‰¯ä½œç”¨
     * 2ã€æ›´å…·ä½“åœ°è¯´æ˜ä»€ä¹ˆçŠ¶æ€åº”è¯¥è§¦å‘ä¾¦å¬å™¨é‡æ–°è¿è¡Œ
     * 3ã€è®¿é—®ä¾¦å¬çŠ¶æ€å˜åŒ–å‰åçš„å€¼
     */

    /**
     * ä¾¦å¬å•ä¸ªæ•°æ®æº
     */
    /*
    const state = reactive({ count: 0 })

    setTimeout(() => {
      state.count = 100
    }, 1000)

    // ä¾¦å¬ä¸€ä¸ªgetter
    watch(
      () => state.count,
      (count, prevCount) => {
        console.log('prevCount-------', prevCount)
        console.log('count-----------', count)
        console.log('ğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜Š')
      }
    )
    */

    /*
    const count = ref(0)

    setTimeout(() => {
      count.value = 99
    }, 1000)

    // ç›´æ¥ä¾¦å¬ref
    watch(count, (count, prevCount) => {
      console.log('prevCount-------', prevCount)
      console.log('count-----------', count)
      console.log('ğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜Š')
    })
    */

    /**
     * ä¾¦å¬å¤šä¸ªæ•°æ®æº
     * ä½¿ç”¨æ•°ç»„åŒæ—¶ä¾¦å¬å¤šä¸ªæº
     */
    /*
    const firstName = ref('')
    const lastName = ref('')

    watch(
      [firstName, lastName],
      (newValues, prevValues) => {
        console.log('prevValues-------', prevValues)
        console.log('newValues--------', newValues)
        console.log('ğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜Š')
      },
      // è®¾ç½®flush: 'sync'ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºæ¯ä¸ªæ›´æ”¹éƒ½å¼ºåˆ¶è§¦å‘ä¾¦å¬å™¨ï¼Œå°½ç®¡è¿™æ˜¯ä¸æ¨èçš„ã€‚
      // æˆ–è€…å¯ä»¥ä½¿ç”¨ nextTick ç­‰å¾…ä¾¦å¬å™¨åœ¨ä¸‹ä¸€æ­¥æ”¹å˜ä¹‹å‰è¿è¡Œ
      {
        flush: 'sync'
      }
    )

    // è¿™ç§å˜æ›´ å‡ æ¬¡ å°±ä¾¦å¬å‡ æ¬¡
    // firstName.value = 'Elon'
    // lastName.value = 'Musk'

    // å¦‚æœåœ¨åŒä¸€ä¸ªå‡½æ•°ä¸­åŒæ—¶æ”¹å˜è¿™äº›è¢«ä¾¦å¬çš„æº, ä¾¦å¬å™¨ä»åªä¼šæ‰§è¡Œä¸€æ¬¡
    setTimeout(() => {
      firstName.value = 'Elon'
      lastName.value = 'Musk'
    }, 1000)

    // æ³¨æ„ï¼šå¤šä¸ªåŒæ­¥æ›´æ”¹åªä¼šè§¦å‘ä¸€æ¬¡ä¾¦å¬å™¨
    */

    /**
     * ä¾¦å¬å“åº”å¼å¯¹è±¡
     * ä½¿ç”¨ä¾¦å¬å™¨æ¥æ¯”è¾ƒä¸€ä¸ªæ•°ç»„æˆ–å¯¹è±¡çš„å€¼ï¼Œè¿™äº›å€¼æ—¶å“åº”æ€§çš„ï¼Œè¦æ±‚ä»–æœ‰ä¸€ä¸ªç”±å€¼æ„æˆçš„å‰¯æœ¬
     */

    /*
    const numbers = reactive([1, 2, 3, 4])

    watch(
      // getters
      () => [...numbers],
      (newNumbers, oldNumbers) => {
        console.log(newNumbers)
        console.log(oldNumbers)
        console.log('ğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜Š')
      }
    )

    numbers.push(5)
    */

    // å°è¯•æ£€æŸ¥æ·±åº¦åµŒå¥—å¯¹è±¡æˆ–æ•°ç»„ä¸­çš„propertyå˜åŒ–æ—¶ï¼Œä»ç„¶éœ€è¦deepé€‰é¡¹è®¾ç½®ä¸ºtrue
    const state = reactive({
      id: 1,
      attributes: {
        name: ''
      }
    })

    watch(
      () => state,
      (state, prevState) => {
        console.log('no deep', state.attributes.name, prevState.attributes.name)
        console.log('ğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜Š')
      }
    )

    watch(
      // () => state,
      state,
      (state, prevState) => {
        console.log('deep', state.attributes.name, prevState.attributes.name)
        console.log('ğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜ŠğŸ˜Š')
      },
      {
        deep: true
      }
    )

    state.attributes.name = 'Musk'

    /**
     * ä¾¦å¬ä¸€ä¸ªå“åº”å¼å¯¹è±¡æˆ–æ•°ç»„å°†å§‹ç»ˆè¿”å›è¯¥å¯¹è±¡çš„å½“å‰å€¼å’Œä¸Šä¸€ä¸ªçŠ¶æ€å€¼çš„å¼•ç”¨ã€‚
     * ä¸ºäº†å®Œå…¨ä¾¦å¬æ·±åº¦åµŒå¥—çš„å¯¹è±¡å’Œæ•°ç»„ï¼Œéœ€è¦å¯¹å€¼è¿›è¡Œæ·±æ‹·è´ã€‚
     * å¯ä»¥é€šè¿‡å¦‚ lodash.cloneDeep è¿™æ ·çš„å®ç”¨å·¥å…·æ¥å®ç°ã€‚
     */

    return {}
  }
})
</script>

<style lang="scss" scoped></style>
